<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kosta.starware.mapper.NoticeMapper">

<sql id="criteria">
		<trim prefix="(" suffix=") AND " prefixOverrides="OR">
			<foreach item='noticeSearchType' collection="noticeSearchArr">
				<trim prefix="OR">
					<choose>
						<when test="noticeSearchType=='T'.toString()">
							notice_title like '%'||#{noticeSearchKey}||'%'
						</when>
						<when test="noticeSearchType=='C'.toString()">
							notice_contents like '%'||#{noticeSearchKey}||'%'
						</when>
						<when test="noticeSearchType=='W'.toString()">
							emp_no like '%'||#{noticeSearchKey}||'%'
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>
</sql>





<insert id="insertNotice">
		<selectKey keyProperty="notice_no" order="BEFORE" resultType="int">
		select notice_no_seq.nextval from dual
		</selectKey>

		insert into notice values
		(#{notice_no}, #{notice_subject}, #{notice_title},
		#{notice_contents}, 0, sysdate,
		to_date(#{notice_startDate}, 'MM-DD-YYYY'),
		to_date(#{notice_endDate},'MM-DD-YYYY'),
		#{notice_state}, 12301)

</insert>

<!-- <select id="noticeListWithPaging" resultType="kosta.starware.domain.NoticeVO">
<![CDATA[
select notice_no, notice_subject, notice_title, emp_no, notice_regdate, notice_hitCount
from notice
where notice_no>0
order by notice_no desc
]]>


</select> -->



<select id="noticeListWithPaging" resultType="kosta.starware.domain.NoticeVO">
<![CDATA[
select notice_no, notice_subject, notice_title, emp_no, notice_regdate, notice_hitCount
from ( 
select /*+ index_desc(notice XPKNOTICE) */
rownum rn, notice_no, notice_subject, notice_title, emp_no, notice_regdate, notice_hitCount
from notice
where ]]>

<include refid="criteria"></include>

<![CDATA[
rownum<=#{pageNum}*#{amount})
	where rn>(#{pageNum}-1)*#{amount}
	]]>

</select>




<select id="noticeDetail" resultType="kosta.starware.domain.NoticeVO">
select * from notice
where notice_no=#{notice_no}

</select>

<update id="updateHitCount">
update notice
set notice_hitCount=#{notice_hitCount}+1
where notice_no=#{notice_no}
</update>

<update id="noticeUpdate">
update notice
set notice_title=#{notice_title},
notice_subject=#{notice_subject},
notice_contents=#{notice_contents},
notice_startDate=to_date(#{notice_startDate}, 'MM-DD-YYYY'),
notice_endDate=to_date(#{notice_endDate}, 'MM-DD-YYYY'),
notice_state=#{notice_state}
where notice_no=#{notice_no}
</update>


<delete id="noticeDelete">
delete notice where notice_no=#{notice_no}
</delete>

<select id="getNoticeTotal" resultType="int">
select count(*) from notice
where

<include refid="criteria"></include>

 notice_no>0
</select>

</mapper>

